/*
 * Realtek Semiconductor Corp.
 *
 * Device Tree Structure
 */

/dts-v1/;

#include "rtl8730e.dtsi"
#include "rtl8730e-spi-nand-256m.dtsi"
#include "rtl8730e-drm.dtsi"
#include "rtl8730e-captouch.dtsi"

/ {
	memory {
		device_type = "memory";
		// DRAM base address should be 1MB-aligned.
		reg = <0x60300000 0xFD00000>;  // 256MB -- exclude 3MB secure memory
	};
	reserved-memory {
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;
		// reserver 32M mem for drm graphics , from 0x61000000 to 0x63000000
		mem_drm_reserved: drm_buffer@0x61000000 {
			compatible = "shared-dma-pool";
			no-map;
			reg = <0x61000000 0x2000000>;
			//linux,cma-default;
		};
	};
};

// Device nodes for test
/ {
	ocp {
		gpio-test {
			compatible = "realtek,amebad2-gpio-test";
			device_type = "gpio-dev";
			rtk,test-gpios = <&gpiob 7 0>,<&gpiob 8 0>;
			rtk,db_enable = "disable";
			rtk,db_div_cnt = <0>;// de-bounce time = (db_div_cnt +1) * 2*30us.
		};

		dma-test {
			compatible = "realtek,amebad2-rtk-dmac-test";
			dmas = <&dma 0>;
			dma-names = "dma_test_cyclic";
		};

		rcc-test {
			compatible = "realtek,amebad2-rcc-test";
			clocks = <&rcc RTK_CKE_ZGB>, <&rcc RTK_CKE_IRDA>,<&rcc RTK_CKD_PSRAM>, <&rcc RTK_CKSL_CTC>, <&clk_osc_131khz>;
			clock-names = "cke_zgb","cke_irda","ckd_psram","cksl_ctc","osc_131k";
		};
	};
};

// Configure peripherals, avoid pinmux conflicts.
//
// Pinmux groups for EV730EL0_3V0:
// Group0: no conflict with other groups, enabled as default
// Group1/Group2/Group3: conflict with each other, should be enabled/disabled by group
// The groups are defined for Realtek internal QC test purpose, adjust the configuration
// as per hardware implementation and user application.

&adc {
	rtk,adc-mode = <1>;
	rtk,adc-channels = <0>, <1>, <6>;
	//rtk,adc-diff-channels = <0 1>;
	status = "okay";
};

&aes {
	status = "okay";
};

&captimer {
	status = "okay";
};

// Pinmux Group2
&captouch {
	pinctrl-names = "default";
	pinctrl-0 = <&captouch_pins_a>;
	rtk,ctc-diffthr = <800>, <800>, <800>, <800>, <1000>, <1000>, <1000>, <1000>, <1000>;
	rtk,ctc-mbias = <0x18>, <0x17>, <16>, <0x1B>, <0x00>, <0x00>, <0x00>, <0x00>, <0x00>;
	rtk,ctc-nnoise = <400>, <400>, <400>, <400>, <1000>, <1000>, <1000>, <1000>, <1000>;
	rtk,ctc-pnoise = <400>, <400>, <400>, <400>, <1000>, <1000>, <1000>, <1000>, <1000>;
	rtk,ctc-ch-status = <1>, <1>, <0>, <0>, <0>, <0>, <1>, <1>, <1>;
	status = "disabled";
};

// Pinmux Group0
&codec{
	pinctrl-names = "default";
	pinctrl-0 = <&audio_ext_amp_pins>;
	ext_amp_gpio = <&gpiob 31 0>;
};

&drm {
	status = "okay";
};

&dsi {
	status = "okay";
};

&rtkpanel {
	compatible = "realtek,st7701s";
	pinctrl-names="default";
	pinctrl-0 = <&drm_disable_swd_pins>;
	mipi-gpios = <&gpioa 14 0>;
	status = "okay";
};

&hash {
	status = "okay";
};

// Pinmux Group1
&ledc{
    pinctrl-names = "default";
    pinctrl-0 = <&ledc_pins>;
    rtk,led-nums = <1>;
	rtk,output-RGB-mode = <0>; // Refer to spec for details
	rtk,data-tx-time0h = <0xD>;
	rtk,data-tx-time0l = <0x27>;
	rtk,data-tx-time1h = <0x27>;
	rtk,data-tx-time1l = <0xD>;
	rtk,refresh-time = <0x3A97>;
    status = "okay";
};

// Pinmux Group1
&ir {
	pinctrl-names = "default";
	pinctrl-0 = <&ir_pins>;
	rtk,ir-receiver = <0>; // 0: tx only; 1: rx only.
	status = "okay";
};

// Pinmux Group1
&i2c0 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c0_pins>;
	rtk,i2c-reg-slave-num = <0>; // I2C master
	status = "okay";
};

// Pinmux Group1
&i2c1 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c1_pins>;
    #address-cells = <1>; // For i2c bus address
    #size-cells = <0>; // Only reg address is needed
	rtk,i2c-reg-slave-num = <2>; // I2C slaves
	status = "okay";
    i2c-test1 {
        compatible = "realtek,amebad2-i2c-slave-test";
        reg = <0x23>;
    };
    i2c-test2 {
        compatible = "realtek,amebad2-i2c-slave-test-append";
        reg = <0x25>;
    };
};

// Pinmux Group0
&i2c2 {
	#address-cells = <1>;
	#size-cells = <0>;
	pinctrl-names = "default";
	pinctrl-0 = <&i2c2_pins>;
	status = "okay";

	rtk_ts@1a {
		compatible = "realtek,rtk_ts";
		reg = <0x1a>;
		ts-reset-gpios = <&gpioa 10 0>;
		ts-irq-gpios = <&gpioa 9 0>;
		max-touch-number = <5>;
		ts-display-coords = <480 800>;
	};
};

&loguart{
	wakeup-source;
};

&rtc{
	wakeup-source;
};

// Pinmux Group0
&sdioh {
	pinctrl-names = "default";
	pinctrl-0 = <&sdioh_pins>;
	status = "okay";
};

// Pinmux Group2
&spi0 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi0_pins>;
	rtk,spi-slave-mode = <0>; // SPI master
	status = "disabled";
};

// Pinmux Group2
&spi1 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi1_pins>;
	rtk,spi-slave-mode = <1>; // SPI slave
	status = "disabled";
};

// Pinmux Group3
&sport2 {
	//pinctrl-names = "default";
	//pinctrl-0 = <&i2s2_pins>;
	rtk,sport-multi-io = <1>;
	rtk,sport-mode = <1>;
	rtk,sport-mclk-multiplier = <256>;
};

// Pinmux Group3
&sport3 {
	//pinctrl-names = "default";
	//pinctrl-0 = <&i2s3_pins>;
	rtk,sport-multi-io = <1>;
	rtk,sport-mode = <0>;
	rtk,sport-mclk-multiplier = <0>;
};

&timer1{
	wakeup-source;
};

&timer2{
	wakeup-source;
};

&timer3{
	wakeup-source;
};

&timer4{
	wakeup-source;
};

&timer5{
	wakeup-source;
};

&timer8 {
	status = "okay";
};

// Pinmux Group1
&pwm {
	pinctrl-names = "default";
	pinctrl-0 = <&pwm_pins>;
	status = "okay";
};

// Pinmux Group1
&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart2_pins>;
	status = "okay";
};

&usb {
	dr_mode = "otg"; // "host", "peripheral", "otg"
};
